# R for travis: see documentation at https://docs.travis-ci.com/user/languages/r
language: r
sudo: required
env:
  - JULIA_URL: 'https://julialang-s3.julialang.org/bin/linux/x64/0.5/julia-0.5-latest-linux-x86_64.tar.gz'
  - JULIA_URL: 'https://julialang-s3.julialang.org/bin/linux/x64/0.6/julia-0.6-latest-linux-x86_64.tar.gz'
addons:
      apt:
        sources: [ 'ubuntu-toolchain-r-test']
        packages: ['libstdc++6']
before_install:
  - CURL_USER_AGENT="Travis-CI $(curl --version | head -n 1)"
  - mkdir -p ~/julia
  - curl -A "$CURL_USER_AGENT" -s -L --retry 7 $JULIA_URL | tar -C ~/julia -x -z --strip-components=1 -f -
  - export PATH="${PATH}:${HOME}/julia/bin"
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E084DAB9; fi
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then sudo add-apt-repository -y "deb http://cran.rstudio.com/bin/linux/ubuntu $(lsb_release -s -c)/"; fi
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then sudo apt-get update -qq -y; fi
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then sudo apt-get install git r-base r-base-dev r-recommended -y; fi
  - Rscript -e 'sessionInfo()'
  - julia -e 'versioninfo()'
  - julia -e 'Pkg.add("RCall")'
  - R RHOME
  - julia -e 'println(readchomp(`R RHOME`))'
  - julia -e 'Rhome = readchomp(`R RHOME`); libR_dir = joinpath(Rhome,"lib"); libR = joinpath(Rhome,"lib","libR.$(Libdl.dlext)"); println(Rhome); println(isdir(Rhome)); println(libR_dir); println(isdir(libR_dir)); println(libR); println(isfile(libR)); println(Libdl.dlopen_e(libR))'
  - ls $(R RHOME)
  - ls $(R RHOME)/lib
  - julia -e 'using RCall'
script:
- R CMD build .
- R CMD check *tar.gz
